<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Netlify + Neon DB Test</title>
<style>
body { font-family: system-ui; padding:20px; background:#f7f7f9; }
button { margin:5px 0; padding:10px 15px; }
pre { background:#fff; padding:10px; border-radius:6px; max-height:300px; overflow:auto; }
</style>
</head>
<body>
<h1>Netlify + Neon DB Test</h1>

<button onclick="createData()">1. Создать data.json</button>
<button onclick="saveDB()">2. Сохранить в Neon DB</button>
<button onclick="loadDB()">3. Скачать из Neon DB</button>

<h2>Логи</h2>
<pre id="log"></pre>

<script>
const LOG = document.getElementById("log");
let DATA_JSON = null;
function log(msg){ LOG.textContent += msg+"\n"; }

function createData(){
    DATA_JSON = {
        project:"netlify_neon_test",
        author:"Nikita",
        items:[{id:1,name:"alpha"},{id:2,name:"beta"}]
    };
    log("data.json создан:\n"+JSON.stringify(DATA_JSON,null,2));
}

async function saveDB(){
    if(!DATA_JSON){ log("Сначала создайте data.json"); return; }
    const res = await fetch("/.netlify/functions/api", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ action:"save", data:DATA_JSON })
    });
    const json = await res.json();
    log("Сохранение в Neon DB: "+JSON.stringify(json));
}

async function loadDB(){
    const res = await fetch("/.netlify/functions/api", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ action:"load" })
    });
    const json = await res.json();
    log("Загрузка из Neon DB:\n"+JSON.stringify(json.data,null,2));
}
</script>
</body>
</html>
