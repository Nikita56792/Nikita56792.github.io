<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>Yandex.Disk + Neon DB Test</title>
<style>
body { font-family: system-ui; padding:20px; background:#f7f7f9; }
button { margin:5px 0; padding:10px 15px; }
pre { background:#fff; padding:10px; border-radius:6px; max-height:300px; overflow:auto; }
input { width:400px; }
</style>
</head>
<body>
<h1>Yandex.Disk + Neon DB Test</h1>

<p>OAuth Yandex Token:</p>
<input id="token" type="text" placeholder="OAuth token" />

<h2>Шаги теста</h2>
<button onclick="createData()">1. Создать data.json</button>
<button onclick="saveDB()">2. Сохранить в Neon DB</button>
<button onclick="uploadDisk()">3. Загрузить на Яндекс.Диск</button>
<button onclick="downloadDisk()">4. Скачать с Яндекс.Диска</button>

<h2>Логи</h2>
<pre id="log"></pre>

<script>
const LOG = document.getElementById("log");
let DATA_JSON = null;
function log(msg){ LOG.textContent += msg+"\n"; }

function createData(){
    DATA_JSON = {
        project:"yandex_disk_test",
        author:"Nikita",
        items:[{id:1,name:"alpha"},{id:2,name:"beta"}]
    };
    log("data.json создан:\n"+JSON.stringify(DATA_JSON,null,2));
}

async function saveDB(){
    if(!DATA_JSON){ log("Сначала создайте data.json"); return; }
    const res = await fetch("/.netlify/functions/api", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ action:"save-db", data:DATA_JSON })
    });
    const json = await res.json();
    log("Neon DB: "+JSON.stringify(json));
}

async function uploadDisk(){
    const token = document.getElementById("token").value.trim();
    if(!token){ log("Введите OAuth token"); return; }
    const res = await fetch("/.netlify/functions/api", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ action:"upload", token, data:DATA_JSON })
    });
    const json = await res.json();
    log("Upload: "+JSON.stringify(json));
}

async function downloadDisk(){
    const token = document.getElementById("token").value.trim();
    if(!token){ log("Введите OAuth token"); return; }
    const res = await fetch("/.netlify/functions/api", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ action:"download", token })
    });
    const json = await res.json();
    log("Download: "+JSON.stringify(json,null,2));
}
</script>
</body>
</html>
